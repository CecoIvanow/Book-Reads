<div class="wrapper">
    <section class="section">
        <h1>Book Details</h1>
        <div class="content">
            <section class="book-cover">
                <mat-card>
                    <div class="media">
                        <img mat-card-image [src]="book()?.img">
                    </div>
                    <mat-card-actions>
                        <section class="owner-actions">
                            @if (userSession.userId() === book()?.owner?._id) {
                            <a class="edit-button" matButton="text"
                                [routerLink]="[`/books/edit/${book()?._id}`]">Edit</a>
                            <button class="delete-button" matButton="filled" (click)="onBookDelete()">Delete</button>
                            }
                        </section>
                        <section class="user-actions">
                            <p>Likes: {{likesCount()}}</p>
                            <div class="like-button-div">
                                @if (userSession.userToken()) {
                                    @if (!userLikeId()) {
                                        <button class="like-button" matButton="filled" (click)="onLike()">Like</button>
                                    } @else {
                                        <button class="unlike-button" matButton="filled" (click)="onUnlike()">Unlike</button>
                                    }
                                }
                            </div>
                        </section>
                    </mat-card-actions>
                </mat-card>
            </section>

            <section class="book-details">
                <div>
                    <h2 class="title">{{book()?.title | titlecase}}</h2>
                    <h3 class="author">by {{book()?.author | titlecase}}</h3>
                </div>
                <p class="added-by">Added by:
                    <a [routerLink]="[`/users/details/${book()?._ownerId}`]">{{book()?.owner?.firstName | titlecase}}
                        {{book()?.owner?.lastName | titlecase}}</a>
                </p>
                <section class="book-summary">
                    <h2>Summary:</h2>
                    <p>{{book()?.summary}}</p>
                </section>

                <section class="comment-input">
                    @if (userSession.userToken()) {
                    <form (ngSubmit)="onCommentSubmit()" [formGroup]="commentForm">
                        <mat-form-field appearance="outline">
                            <mat-label>Share your thoughts...</mat-label>
                            <input matInput type="text" formControlName="create-content">
                        </mat-form-field>
                        <div class="button-container">
                            <button mat-raised-button class="post-button" type="submit">Post</button>
                        </div>
                    </form>
                    }
                </section>

                <section class="comments">
                    <ul>
                        @for (comment of comments(); track comment._id) {
                        <li class="comment-item">
                            <mat-card>
                                <mat-card-header>
                                    <img mat-card-avatar
                                        src="https://as2.ftcdn.net/v2/jpg/03/31/69/91/1000_F_331699188_lRpvqxO5QRtwOM05gR50ImaaJgBx68vi.jpg">
                                    <div class="comment-header-content">
                                        <div class="comment-meta">
                                            <a [routerLink]="[`/users/details/${comment._ownerId}`]">
                                                <span class="comment-author">{{comment?.owner?.firstName}} {{comment?.owner?.lastName}}</span>
                                            </a>
                                            <span class="comment-date">â€¢ {{comment._createdOn | date}}</span>
                                        </div>
                                    </div>
                                </mat-card-header>

                                <mat-card-content>
                                    @if (clickedComemntEditId() !== comment._id) {
                                    <div class="comment-content">
                                        <p>{{ comment.content }}</p>
                                    </div>
                                    } @else {
                                    <form (ngSubmit)="onCommentSubmit(comment._id)" [formGroup]="commentForm">
                                        <mat-form-field appearance="outline">
                                            <input matInput type="text" formControlName="content">
                                        </mat-form-field>

                                        <mat-card-actions class="comment-actions">
                                            <div>
                                                <button class="edit-button" matButton="text" type="submit">Save</button>
                                                <button type="button" class="delete-button" matButton="filled" (click)="clickedComemntEditId.set(null)">Cancel</button>
                                            </div>
                                        </mat-card-actions>
                                    </form>
                                    }
                                </mat-card-content>

                                @if (clickedComemntEditId() !== comment._id) {
                                <mat-card-actions class="comment-actions">
                                    @if (userSession.userId() === comment._ownerId) {
                                        <button class="edit-button" matButton="text"
                                            (click)="onCommentEditClick(comment._id, comment.content)">Edit</button>
                                        <button class="delete-button" matButton="filled"
                                            (click)="onCommentDelete(comment._id)">Delete</button>
                                    }
                                </mat-card-actions>
                                }
                            </mat-card>
                        </li>
                        }
                    </ul>
                </section>
            </section>
        </div>
    </section>
</div>